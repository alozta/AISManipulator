/**
 * Created by Ozan on 17.10.2016.
 */
package com.alozta;

import com.mongodb.MongoClient;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import org.bson.Document;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;

import java.io.*;
import java.util.ArrayList;
import java.util.Map;
import java.util.Scanner;

@SpringBootApplication
@EnableAutoConfiguration
public class AISManipulator {
	WebService ws = new WebService();
	private static MongoClient mongo = new MongoClient("localhost", 27017);
	private static MongoDatabase db = mongo.getDatabase("bitirme");
	private static MongoCollection collection = db.getCollection("ais");

	public static void main(String [] args){
		String path = "C:\\Users\\Ozan\\Desktop\\Bitirme\\AIS_data\\20161117.csv";       //input file path

		//addAISInCSVFormatToDB(path);                      //ADD NEW ENTRIES

		//System.out.println(getVesselInfo("616715000","2015-10-10 00:00:00.0","2017-10-10 00:00:00.0"));
		//System.out.println(getAllDistinctMMSIs().size());                     //how many unique vessels are in the db

		/*for(Document d : getAllDistinctMMSIs()){
			System.out.println(d.get("_id"));
			//for(Map.Entry e : d.entrySet()){
				//System.out.println(e.getKey()+":"+e.getValue());
			//}
		}*/
		/*Document d = db.runCommand(new Document("$eval", "db.ais.distinct('mmsi').length"));
		System.out.println(d);*/                            //output: Document{{retval=3588.0, ok=1.0}}, distinct vessel count

		SpringApplication.run(WebService.class, args);

		saveOfflineVesselData();
	}

	public static void saveOfflineVesselData(){
		ArrayList<Integer> corruptedQueryResults = new ArrayList<Integer>();
		int i=0;
		try {
			//save each query in different file
			for(i=0; i<distinct_vessel_mmsi.length; ++i){
				PrintWriter writer = new PrintWriter("C:\\Users\\Ozan\\Desktop\\Bitirme\\AIS_data\\offline\\vd_"+i+".txt", "UTF-8");
				try {
					getOfflineVesselData(writer, distinct_vessel_mmsi[i]);
				} catch (com.mongodb.MongoCommandException e) {
					e.printStackTrace();
					corruptedQueryResults.add(i);
					System.out.println("Corrupted query results: " + corruptedQueryResults.toString());
				}
				writer.close();
				System.out.println(distinct_vessel_mmsi[i]+" is written. "+i+"/3588.");
			}

			FileWriter fw = new FileWriter("C:\\Users\\Ozan\\Desktop\\Bitirme\\AIS_data\\offline\\offline_vessel_data.txt", true);
			BufferedWriter bw = new BufferedWriter(fw);
			PrintWriter mainWriter = new PrintWriter(bw);

			//aggregate uncorrupted results in a single file
			for(i=0; i<distinct_vessel_mmsi.length; ++i){
				if(!corruptedQueryResults.contains(i)) {
					BufferedReader reader = new BufferedReader(new FileReader("C:\\Users\\Ozan\\Desktop\\Bitirme\\AIS_data\\offline\\vd_"+i+".txt"));
					String vesselData;
					if((vesselData=reader.readLine())!=null){
						mainWriter.print(vesselData+"\n");
					}
					reader.close();
					System.out.println(distinct_vessel_mmsi[i] + " is read. " + i + "/3588.");
				}else{
					System.out.println(distinct_vessel_mmsi[i] + " is IGNORED due to the corruption. " + i + "/3588.");
				}
			}

			mainWriter.close();

		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} catch (UnsupportedEncodingException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	/**
	 * Save vessel data in mongodb in javascript readable, JSON array format. The data is sorted in ascending order.
	 * This function increases usability of the system by decreasing data fetching times.
	 *
	 * @param writer File descriptor
	 * @param mmsi Vessel id to be searched in mongodb database
	 * */
	public static void getOfflineVesselData(PrintWriter writer, String mmsi){
		String startDate = "2013", endDate = "2017";
		String cmd = "db.ais.find({" +
				"mmsi:\""+mmsi+"\"," +
				"date:{$gte:\""+startDate+"\",$lte:\""+endDate+"\"}" +
				"}).toArray()";

		Document d = (Document) MongoConfig.getMongoClient().getDatabase("bitirme").runCommand(new Document("$eval", cmd));
		ArrayList<Document> l = (ArrayList<Document>) d.get("retval");

		writer.print("var mmsi_"+mmsi+" = [");
		for(int i=0; i<l.size(); ++i) {
			if(i!=l.size()-1) {
				writer.print("{" +                           //delete first comma in the file
						"\"mmsi\":\"" + l.get(i).get("mmsi") + "\"," +
						"\"date\":\"" + l.get(i).get("date") + "\"," +
						"\"lat\":\"" + l.get(i).get("lat") + "\"," +
						"\"lon\":\"" + l.get(i).get("lon") + "\"" +
						"},");
			}else{
				writer.print("{" +                           //delete first comma in the file
						"\"mmsi\":\"" + l.get(i).get("mmsi") + "\"," +
						"\"date\":\"" + l.get(i).get("date") + "\"," +
						"\"lat\":\"" + l.get(i).get("lat") + "\"," +
						"\"lon\":\"" + l.get(i).get("lon") + "\"" +
						"}");
			}
		}
		writer.print("];\n");
	}

	private static String[] distinct_vessel_mmsi = {"616715000","671785000","214182318","271002624","229227000","255805831","209182000","271000903","667001617","636014291","271010332","677030700","271010036","538004913","271042689","271010796","271001021","271010522","271040223","271002272","271040174","271042730","271073013","271044270","538002689","271000975","2711011","27101502","271041054","271010094","215379000","271001039","271000086","371202000","2717210","271040610","271043746","271044519","241193000","271042659","636014505","215872000","271010566","2078","992711104","477143100","518825000","271072489","248754000","229947000","271020201","271000302","518947000","271043926","271043710","2717207","357121000","271042475","676267000","271010708","271010302","636015975","271000907","271010541","636016017","271043437","271002504","271010306","636012630","271010609","271043444","248864000","271002527","271040027","271010517","271072409","271010163","271056047","248573000","423047100","373735000","992716091","271002603","992711024","271040085","271010533","273327420","271072266","271044292","271010120","271010312","271010510","271010436","271043872","273338300","271010323","248697000","271072079","271044052","271010395","271044172","2717204","271010449","271010238","271001083","271072204","271043017","271043875","457268000","271010500","271002736","271000836","271040325","271040618","271043518","667972000","271072116","671706000","271000798","271000088","271043797","271042656","271042015","271043887","271010396","271043664","271020183","538002757","271040052","371564000","229590000","271040239","271010367","511122000","271000921","271042403","271042838","271020101","271042238","271020095","338071873","992711039","271002106","271010327","271010508","271002638","271041685","271042693","248400000","271062028","374411000","309695000","271020147","271020131","271002256","428068000","271005005","272505000","271043222","271010326","271002500","271042297","271041687","271010531","271042938","271010518","256554000","518856000","667001460","271040189","271042998","511107000","319543000","992711389","271043526","271010335","271002440","271072173","271010247","271042997","271002569","272489000","271001134","538005381","271040667","271041599","271044156","271010737","271002224","271044154","271040758","271072843","667001302","207822390","271020168","518807000","374997000","271041977","271043317","271044452","271042854","271010340","271000493","271002130","271044098","271056053","271010619","271000817","271042742","271010457","271002595","271010382","374367000","354800000","271044095","271010698","271020119","271020132","622122208","271010031","271010063","992711040","271072200","271020096","992711350","271042933","271010513","271002522","271010360","271042287","538002073","271043486","271043070","271010111","271040623","271041124","271003364","271044031","271002637","271044153","271002706","271010514","271042093","373249000","353429000","271005004","271010505","271044175","271042888","235070674","271043018","271002497","271044224","271010389","271010536","271010620","620161000","518865000","667001655","271020086","271040008","271073127","271040307","676174000","273318010","218817000","271010338","636017582","357297000","511108000","271040153","271056054","271044128","518896000","271043970","271002468","214181421","271043215","992711064","373175000","271041245","271010445","271042645","271010660","271010311","271042412","271040049","377221000","777777777","271044329","271040570","271040624","271042963","271044084","271010206","271000488","992711036","271040831","353719000","271043976","271044320","271000792","351607000","271010288","271010488","577276000","271010263","271010333","271000748","256714000","229322000","271010388","249607000","271010298","271010363","271010509","271000716","271010539","271042994","271010552","271043572","992711065","271040455","2717245","422065800","370601000","305282000","272088600","538005292","271002526","271002427","271002290","271043805","271010511","271000976","271010285","271043987","111853581","271010292","271043641","271043766","271043410","271000894","271010506","271002472","271010265","271044216","271042906","271002181","271002467","271000220","271002524","271010295","271002511","271010171","271002377","271035214","271002508","271020080","271010523","271002502","357925000","271043014","271042941","271010336","271010192","271010294","271010309","271002519","271043493","271010420","249182000","271042233","271041514","271043741","271040757","271010267","271010574","271040235","272145000","271001052","992711395","271002711","271010115","620125000","351675000","271043349","271043460","271043745","271010208","235024966","219339000","271020133","271010666","271070519","271001277","271040315","314338000","247241200","510248000","271010564","271010773","271000583","271002518","271010264","992711021","367741790","271010515","271040573","271041607","271044155","271043402","271044056","992711100","271001019","271010795","271042202","271010610","271000159","271010526","271062146","271010659","271010268","271042783","271002470","271010742","271010378","271010849","677058800","271010300","271010125","271044242","271000313","271010520","271042945","351750000","271072918","271044130","671208000","271044488","271010598","253193000","677040700","357051000","271042879","256614000","271001169","271072250","271002474","271010587","271002221","271043905","271002374","271043756","636014783","236166000","271073131","271041844","271010316","271072261","271072294","271010538","271002065","271040397","271010241","271072616","256280000","229327000","271044168","271041894","271002475","271002505","271010269","671738000","261036130","248734000","677017000","271010458","271002147","271010400","271010324","271002550","271010279","271002478","374281000","271010676","271010293","271002191","271043659","271010548","271002119","271043936","271010628","271010270","676129000","271043362","271000005","271002395","271044453","271002365","271010290","271010647","671790000","229566000","271010571","271010262","271002466","518654000","271040181","271072458","271044072","676067000","271010615","271002266","271042486","271002469","271044397","271002555","271043901","271002132","374934000","271010219","248901000","271042647","271040319","271043985","271010722","271042089","271002342","271010504","271010283","271010266","229312000","271072241","271002464","271072077","271044024","271010524","538003911","992711349","271000906","271010635","271073045","271042349","271062108","271010322","357250000","271044431","477108800","271042583","636014982","271056006","477117700","271002517","271042366","373571000","271062131","538004031","423035100","271042951","577288000","370087000","271073091","311000231","271043764","256840000","272056000","271043933","271000789","271043093","271072808","271043195","271000538","271062130","271010167","271072107","255805694","271043927","271072288","271010297","271002477","249017000","271043763","271010642","271010146","209257000","271043573","256331000","271041391","246302000","667005086","273358650","249032000","249537000","271005002","353430000","564517000","271044398","677041300","271040492","271056028","271010223","271010257","271010585","271073175","273372000","538004070","271043941","271043725","271002656","351400000","518100188","565473000","667001240","565196000","271002254","271043475","271044327","256644000","272144000","538004110","271010447","636013273","422035400","241090000","273315640","271043008","271044343","357227000","271042433","373824000","235100059","271002064","271000228","518100167","636016562","357444000","357106000","992711055","271002213","2714063","271042562","538003317","214181814","2717208","271002587","271040295","671303000","538006969","214182412","27121300","271072176","248693000","256256000","271043731","374334000","271044013","636016912","370596000","256183000","564429000","215371000","538006541","355065000","312759000","271043661","271002348","564860000","373204000","271042494","671527000","636015530","356791000","636017228","271010582","457277000","271043015","538006996","247039400","636015263","636016284","374821000","271002162","370614000","992711044","271002250","636091962","2717252","271072396","518843000","271000216","271010527","271010392","256960000","271010721","271043568","273339310","338120353","271010834","538004924","273339630","271010313","271010281","271043080","219196000","215059000","271010334","271010291","538004399","248961000","273310040","271010280","271010328","636012131","271010308","422041100","271000936","215123000","271043391","271010856","566813000","273430590","271002476","271041933","677019400","677098300","538004179","271010565","271010273","273336670","271043743","271040874","271043916","511326000","374574000","271010393","271010321","271041948","271010126","271002676","271040694","271010906","511411000","240575000","271002096","271000077","249028000","422034300","271043794","271002318","271010337","271040157","271002077","636012854","477289900","339300920","271000030","271010314","271040378","373746000","341575000","17835810","271010419","304604000","271040280","272087000","271040301","271000767","367615790","538004996","271040987","271043580","246227000","271010195","271010310","247304200","220425000","271010730","273340110","271000691","271002214","271010299","271010303","271010720","271010215","271010677","271044350","271000910","271040236","518419000","373251000","258724000","538003264","229799000","271044428","671780000","271044410","249398000","271072906","271010516","992711089","271002473","271010317","671733000","677085700","214181102","311073800","271062065","304739000","338202387","271000598","271002600","215085000","992711083","256365000","352437000","667002157","372202000","367752550","271043802","371395000","992711053","271073167","511011035","677022400","271000578","271044594","311016600","207832960","538006829","271010164","671505000","249209000","271044102","247363700","538004508","271010682","667005244","636013645","371074000","236112259","308688000","518915000","271072103","271044552","271072789","248549000","338211438","271001020","271010623","255805777","377474000","777888999","271042957","2070815","271020125","271020141","271056045","2070421","271000388","538003889","271010339","273415410","271044604","372735000","271002465","271010478","271000267","271044017","636014356","271043491","271040078","271072029","271072334","271044545","538001404","636017595","271044256","214182515","538004444","667639000","671500000","636014502","247217500","305211000","249550000","636015266","271010128","271002058","271044366","271010441","271000253","667001493","271042440","271002391","312194000","240269000","241060000","357398000","27102284","271000650","215864000","311043800","616189000","271044318","271010213","271044342","457273000","273331900","271044301","271002044","538004456","271002238","518721000","271044073","305108000","671659000","273352430","671501000","271010209","371715000","256582000","676246000","271002439","271000673","356843000","312629000","271043811","214181505","511148000","209558000","271044082","676057000","477998100","577300000","247288900","667001541","1936452","271002424","353505000","4406","371046000","636016656","271010216","374071000","271000414","271000743","271044265","511118000","373969000","231257000","538005284","212337000","271040150","271002246","271040321","246745000","311003500","352642000","271044070","271002735","271072321","271010859","271000869","636017383","271000739","271062045","271000793","248499000","256234000","271000612","271072214","311033200","226099000","372700000","271000251","256337000","271042657","271073118","248558000","271044212","671821000","271072580","636092530","309542000","249502000","423456100","271042529","205437000","271072184","273419310","620050000","229039000","566900000","671011000","271044362","352168000","271000884","312094000","273389360","271042741","511363000","240517000","636012978","271007001","577229000","240597000","269019000","354854000","249083000","271999999","992711000","271002057","271020182","271271271","271002372","671737000","636015954","353213000","271010234","312963000","566429000","357634000","247186300","211377290","353211000","518610000","271020122","538006505","271043750","565810000","249618000","240058000","636092037","319069500","351732000","213598000","271010572","636017698","357365000","248843000","538005829","215106000","636016477","271042158","565775000","210278000","271072061","371263000","271000973","676186000","304010960","271010695","671761000","351770000","248016000","214180801","616505000","271040134","271043733","215705000","636013332","271010586","241242000","518100004","677054000","271044480","256096000","235067944","249801000","271044288","271000601","271043438","271042738","616884000","271072683","271015000","248821000","311051200","2711021","351532000","564936000","676248000","257711000","538002883","566462000","538005657","357483000","240715000","304921000","312012000","273355680","256241000","616282000","214111114","241190000","271000092","538007056","273453310","636092220","271073065","249885000","271002103","271043669","212346000","373154000","240472000","271002170","271072118","246611000","538004922","636013239","518100192","422880000","312658000","271044409","538004182","271002384","564364000","240787000","273430720","273381900","271000654","311007700","370356000","676102000","311552000","677087700","272122000","273316430","271002456","518100289","249092000","271001049","676217000","271000433","235083559","477078500","371310000","304634000","636016011","271044036","305885000","636092741","636015742","271044068","305459000","271072594","373259000","636092723","271072582","538006612","671781000","214181113","248497000","538005937","373532000","636091637","311041700","271043758","272077000","538004273","273320600","271056004","271056015","352187000","271000734","273350280","248801000","677021400","271044022","271072578","271043303","271010374","256824000","271010414","251114018","271000956","356071000","271035236","636014253","271043793","256823000","271043621","636011491","271035235","305393000","235105944","271035237","271010455","538090399","271056020","372425000","269997000","271040881","257845600","538005399","271043323","357627000","271001247","271043139","271010907","305445000","271043137","271010187","677039900","636015406","271044328","671437000","271056032","271010667","271056035","241231000","271002572","271020137","8235689","271043954","256575000","271010540","271010643","271043744","214182316","273342180","425000010","240635000","271042652","636017382","271072076","273341110","255805581","271042133","671367000","371448000","370856000","312368000","538003857","518100106","271002598","229558000","271072755","423025100","256186000","620010000","636092135","271040669","271020045","271040403","271043544","271002732","271002078","271010425","538002561","341922000","271002126","671823000","370059000","271010535","271002726","271072071","538006274","246666000","636016381","477790600","636016746","241298000","312451000","214182511","247149200","256305000","271002403","271010710","374211000","457275000","271072410","518100029","305691000","256109000","677023300","677062000","215329000","577234000","636014194","271002215","423029100","271001001","271043595","271072175","271072156","271002018","245839000","538003926","808691006","271002187","271000934","271072134","271043810","271072150","304962000","371365000","215695000","636091793","676092000","271010758","271043457","351189000","214182422","374901000","367351020","538004733","538005195","271040349","229363000","636012769","271001012","256910000","676167000","235075588","355758000","241462000","256957000","271042480","477444300","636015065","241262000","622121421","273334100","271072331","271042611","271002164","477178900","256182000","370176000","271056037","271044206","273437770","271000745","244142000","271444038","247284100","271010092","271002571","241130000","271044390","377715000","244820009","374343000","271010529","271043558","249533000","273376000","271072689","566266000","374130000","271041028","214182623","377789000","355534000","271043122","450559000","577298000","352446000","271002359","271044062","457356000","215462000","572623210","271041210","271043221","271044034","271010466","667001282","538005162","248598000","271001058","271010525","271020102","518100185","271000623","518790000","271042759","371919000","311000159","271000781","677096000","271002011","249297000","271002381","374824000","229101000","256579000","271043406","271043795","229353000","273339300","245935000","273313720","538006952","311025800","271002007","273332230","215029000","271062099","352672000","256161000","271073158","271043152","271043383","636017332","271043454","229465000","256891000","271002357","241444000","374666000","636091685","271002176","256967000","273356390","247218800","352264000","271043701","373967000","256382000","241454000","636014353","240586000","215782000","259025000","256020000","370191000","271001028","271002242","271002201","271000539","312417000","255805679","271002429","256712000","249746000","271062085","636012794","351976000","374818000","272765000","636012774","271002520","271002024","235111681","538003413","565814000","271002123","636014902","312770000","271043704","564879000","636014111","564484000","258328000","636013337","271042564","538004631","17835818","271042974","374778000","249784000","273332380","305811000","271056000","305775000","219512000","671209000","215784000","538007057","312281000","214182224","466213000","215795000","215983000","271072367","215521000","271010648","373898000","271010065","304010085","273343110","256488000","271042246","671346000","273314540","671657000","677041700","271044357","241319000","518570000","256942000","244860007","207824290","271000829","271010895","271010286","247226900","271040077","255805671","372843000","357702000","271002689","422039900","271010194","357313000","271000662","271044021","271002251","477115800","271044375","518968000","272532000","518840000","229246000","271015017","312481000","538005901","370802000","538002982","563533000","248507000","271010173","423066100","374040000","273340640","372045000","477866600","271010239","244830877","352451000","367335070","636012904","207829620","374760000","245057000","271043540","304089000","676276000","374742000","247293700","372924000","538005958","352952000","271123400","371949000","271010237","271010578","272085000","374533000","273340850","357254000","538004037","249615000","271044071","271044460","271043016","477760900","538002772","214181602","271002565","354899000","312404000","355998000","271044295","272295000","271000733","210940000","371125000","271042636","247163500","341552000","356196000","214182630","636017413","271043899","271000957","215781000","229898000","271008507","273430870","238233000","249447000","538005221","271002265","405000163","235060524","273339400","207320000","271010019","518559000","305481000","477133800","271000753","271001057","538005161","273331200","271043443","323671048","258797000","518718000","273332300","271030137","538005297","249870000","374819000","271044259","271002662","248658000","229396000","477193300","271043836","636092619","372644000","577232000","304639000","273447030","518938000","272031000","271044233","271002023","271044251","214182501","305367000","273360870","351224000","351180000","240311000","271043837","353527000","992711101","271043400","671359000","271000276","511161000","271002512","572341210","367614680","311000324","367719890","271010743","636014098","566816000","676169000","676189000","271073174","636014488","229440000","271040324","538003882","440114000","605086120","548860000","271010894","271000961","271002090","377583000","271000744","215170000","367681180","341438000","271001093","271042539","249462000","636011212","376468000","271010452","376504000","271010584","305102000","256107000","271010614","636091872","312616000","538003513","271000874","271043138","247146000","352212000","352201000","255805674","271000930","271043798","477608900","374881000","314024000","620146000","636016455","214182202","636014709","229940000","671345000","477346300","370785000","371978000","256247000","636092739","677095700","311049400","249674000","255805622","502774724","273375360","667001379","271002578","229276000","244908000","273355260","271002688","356959000","249813000","341287000","677043000","371733000","677042200","636016427","371334000","565969000","229048000","236446000","353056000","565654000","249201000","219118000","636092301","351931000","477514900","273338330","312661000","572871210","538003159","247301500","565594000","256132000","620082000","240728000","374749000","671309000","271002328","271042435","538070806","247153300","271010032","636091529","246484000","271073169","271042609","992711025","276823000","249348000","538003816","246358000","538003966","518100184","636014894","566722000","374531000","271000025","214180702","215096000","311053100","271041934","256945000","271010512","271010603","271000122","248033000","271043625","51390250","238236000","272293000","355814000","563353000","538005475","667001692","271000919","271002264","636016185","373188000","667001587","352449000","309964000","636009840","636091346","209532000","247285800","636015292","271044139","240788000","357224000","319014800","271042996","636014809","256713000","241212000","357207000","271043717","622121409","304843000","428046000","538006371","338127281","538002849","353512000","311743000","992711398","271000768","538004369","636091576","377249000","636092217","636016941","271043840","373519000","538006367","271010450","422043200","636015911","247098600","373071000","271042556","271000882","215770000","241322000","356306000","667001522","271043255","518100165","271010029","271041492","422039200","249988000","375276000","271044425","273339480","256356000","518943000","271010284","271010804","373016000","271000419","271042650","309402000","677062400","518100053","616963000","992716090","271056046","304031000","256683000","636012659","356444000","992719092","258667000","305446000","371769000","232003353","271001038","305727000","538004119","229281000","518100056","622121422","671811000","249160000","538006645","271044294","636012422","538006823","372100000","511009000","271000252","271010193","214182424","667001555","565227000","271002035","477669300","636015708","538002594","271044386","229845000","373794000","566424000","271040583","413360000","255805702","271010681","636092738","273133800","538005146","677063200","271044602","255805769","271044597","248011000","271044177","256391000","229364000","373260000","269076000","477552400","372916000","271044051","566258000","477759200","311076200","273351980","271043409","565516000","538005517","309285000","271072645","215947000","271072247","271010221","271000065","214182426","273425510","312718000","271073114","244650317","246867000","271062064","271072357","538004665","576082000","258491000","271002438","271044483","271072117","272053000","256476000","271002039","248098000","2711009","271010612","564361000","370447000","256914000","566689000","229992000","403511001","271056059","562976424","256155000","271056033","271000615","312092000","271001063","616886000","246789000","351653000","636015371","271073115","373470000","238250000","377768000","248280000","311005700","636015817","518100193","271010362","450542000","538005183","667755000","215228000","271000119","538006436","538005403","271072137","538004675","354562000","271056022","271000021","271072131","419001060","271002143","246719000","667021000","374156000","319643000","311000450","244521000","255805624","312256000","373663000","538003988","271002615","378112046","538006926","538004073","422040900","371249000","256483000","271072127","312600000","273378690","235102885","256682000","636015074","271056036","374780000","271010083","271072406","538003964","273417510","271044067","353312000","271000266","450554000","370429000","422050300","271072361","271000825","271000423","511255000","355008000","271042719","271044280","273337920","271056029","249344000","271056025","271043081","214181201","247311300","671559000","374967000","565971000","271072987","273458830","636092268","256678000","271035215","235800000","249796000","271044348","676289000","677037200","271056030","271042508","271072446","351642000","249266000","373556000","538090373","271044426","357157000","271010427","271010706","271042584","538005855","271043560","214182625","351482000","239876000","256903000","271042049","477222800","353607000","249686000","636091634","271002326","236111906","271073147","538005700","622121420","667001583","271043407","538001577","271040024","355412000","215166000","620133000","373306000","622121414","372968000","667949000","271010813","271041000","271044120","636091473","271072093","271072356","271073101","271072255","271072888","271073074","304926000","311008100","377239000","677026300","256623000","605086013","240949000","271044349","271000661","273317430","636012095","309716000","271040695","257557000","538003122","671389000","373639000","271072861","518697000","271000926","271072370","457263000","375166000","249955000","7120184","374589000","538004506","256544000","219544000","271072088","271072870","271069034","248406000","271002247","271072756","271073073","271040314","271010307","271043624","351235000","271000269","271044163","271002481","518624000","271001050","271072345","538004091","246252000","371584000","271072400","249972000","518864000","271000672","272142000","357231000","271001025","355948000","271010792","250002045","538002071","271073188","477360500","354556000","271040299","271073037","271040043","271072507","219216000","356579000","271072265","311000316","355854000","248054000","538090297","636017603","214181820","271044606","271044608","214181709","311000277","271040062","538004722","271043984","247116600","636091278","247306600","371873000","271000766","271002471","214180912","636016210","370264000","256416000","271000050","271002360","373157000","256918000","477637700","244971000","236603000","319077500","667989000","249007000","271072403","518969000","636010400","253144000","677052100","271044550","518100189","248551000","273351260","271000871","248001000","273352260","271010662","214182303","256992000","305548000","249379000","271044033","271002498","351808000","272048000","314422000","374377000","271000501","255805953","564182000","271044467","215113000","305949000","256547000","477962300","249147000","229884000","273375000","304010986","273333560","247078500","273387100","577273000","214180204","271010774","566638000","308808000","356572000","677015500","246347000","235101908","247239700","271000833","371040000","248495000","636016745","271010567","636013144","241029000","271042757","620119000","538005283","255805689","271002125","311681000","271002114","377675000","376279000","247061100","229700000","511233000","271002180","564580000","271010198","577302000","538004120","236576000","256549000","271040963","271072422","671688000","220016000","667005102","271010655","377609000","271072027","311143000","312119000","311055500","248184000","677032800","622121425","215566000","356182000","248737000","538005114","271043163","214181405","374917000","271072551","271043403","352486000","229843000","372810000","272308000","256672000","271040601","271044166","271062086","256202000","271056026","256383000","636091488","271062072","271043852","310743000","271042643","511007000","249696000","248176000","304204000","518955000","667005239","312793000","538004504","671741000","376261000","538005941","373605000","271002259","271072335","271072953","271073110","271069031","677060400","352521000","622120321","636092247","518100105","237419410","256651000","273362290","319065400","214182423","247275400","271073012","374630000","273314430","636016819","271072613","636016261","215958000","371985000","271072095","271042845","518100232","538006921","271000939","518700000","620031000","636014500","676087000","538006547","622120442","271062070","677034600","510115000","247282300","271008504","538005728","271002544","246542000","636015627","667001239","667001657","271072049","565136000","215856000","311046200","671338000","373781000","671558000","229810000","677022700","271042939","312297000","271000918","304496000","518100216","341593000","273362100","3586","271072459","374838000","518100278","256472000","538005398","271062093","356167000","566502000","1193046","374712000","271072161","271072452","636016985","374942000","357340000","341648000","271062106","273330220","271072106","636092390","376762000","271072207","667001286","256551000","518100059","538005006","271043424","311000607","374365000","271000724","271072203","229811000","671378000","620091000","271044443","667001463","249710000","373882000","271072571","271043668","271044537","636016233","246716000","992711007","538002845","249941000","271002506","423059100","271056050","271043863","219117000","271010379","271072992","271072915","229699000","671396000","271062050","271062049","271062066","271010191","271043432","248132000","272140000","256652000","271073026","271043277","538004461","271056040","271056013","271073096","271069036","273335510","538004342","214182624","271072280","271069033","316031773","510357000","271072243","271073143","249530000","564726000","273351280","271072352","271072142","271010715","271072091","271072113","422038900","273327500","248829000","271000352","371720000","271072471","538005507","373575000","273312800","377523000","351120000","241357000","241241000","271010431","256453000","353442000","377757000","311008700","271000732","264900259","271072068","271062127","271062148","271072166","356087000","271073061","620131000","511307000","218822000","477610000","210523000","271072364","616999191","676294000","271043241","636092423","212954000","371838000","232005265","636015991","311000157","271002200","229938000","229345000","235025241","271010812","477266700","271062073","2711007","271073129","636016691","356807000","271042303","256033000","271002559","273338920","271020172","565977000","538007115","273318810","256323000","271043893","354123000","271072955","258749000","563933000","319204000","215171000","563508000","671217000","271073195","372658000","305686000","271010182","538003703","271010030","518100210","538002648","271072432","273350780","271073016","356703000","271056008","271000013","271000506","273415080","271072559","374871000","271062121","636092323","311069200","249718000","671046000","273343220","240699000","538002123","271072100","616409000","229691000","214181911","636012754","245867000","273447120","256648000","273430690","271073100","271072128","273445370","271072416","271000359","371526000","511336000","312366000","311000134","312176000","311013400","246769000","271072903","636012647","311000094","273357900","273347600","271000056","229829000","271043072","256228000","305859000","538090484","214182124","256724000","602157000","616999005","311000516","671466000","312809000","636013026","215976000","636017300","311000160","667001653","620023000","246924000","565544000","511315000","357197000","273431620","229692000","273437050","636013959","373042000","241344000","271072111","271000483","249323000","538090188","256705000","271001018","256743000","246807000","220495000","271072112","271072553","271073121","237162000","214181706","271073036","271072444","538006954","271072946","636017324","676104000","273439520","271072702","271010034","620158000","538006494","477765200","271073023","374846000","636092190","305177000","677016400","236592000","538002693","273357280","312638000","677032500","273416080","353502000","271000647","518100187","271002709","352080000","271044363","271073047","271062094","205680000","676158000","423394100","271002075","373019000","256049000","273359580","616294000","305333000","312974000","271001173","566872000","357847000","305175000","271062081","271073160","273323300","636092053","352939000","214182521","636011490","352384000","677093700","620021000","271002353","239989000","212717000","244790606","247065500","636014349","423056100","305026000","271062061","271072208","271056077","271072974","271010127","538004437","271062062","271062143","271042675","271072378","256829000","271073039","518812000","341788000","518917000","356833000","214180509","272494000","620081000","229145000","257962000","215691000","271073194","518100055","305534000","247064200","271072215","518691000","667797000","538005701","256828999","566523000","312949000","214181717","436000223","355290000","273544130","636016127","256318000","355529000","351020000","671697000","271062054","271072609","248220000","257949600","271040063","271010118","271010117","373310000","271044439","271010432","367635110","271002108","305842000","671643000","271002305","354486000","240942000","249135000","273334200","244271000","413471960","271072753","271043501","249817000","249114000","304768000","273337300","566395000","304461000","620035000","273339410","518800000","271072556","376566000","215810000","247286900","271072376","273447490","577187000","273317010","564756000","271072047","271069023","273319100","370808000","422005171","271072347","616920000","422041300","271044531","374029000","273439590","271072615","238293000","256818000","305555000","636091858","271072114","667001285","271000770","271000834","353275000","271044293","357474000","667001290","248298000","311000536","538003702","372105000","356903000","271043004","538090362","319076000","271072595","271044298","273437420","538002957","248397000","351344000","229899000","271044249","564896000","538006667","214181418","271002642","246676216","371911000","271073003","271072570","271044515","271073187","676068000","271000779","229144000","246877000","311034100","375843000","229809000","271062088","271062034","271002040","271062035","271073063","312086000","271062036","305562000","247286300","235112065","305049000","271000203","258884000","312715000","477013400","271062046","636016433","636016374","271062052","305094000","249713000","636017477","548858000","667203600","354449000","351429000","309553000","229882000","376099000","538005651","636017160","511116000","354127000","667005068","538002852","477910000","249478000","237928000","304037000","235103287","477904500","676254000","271072164","240437000","255803540","622121423","271072057","212273000","271072690","235084729","636016429","271062084","457264000","636016747","271072025","271072026","271043786","311957000","271072675","356642000","271072866","215430000","214181402","371702000","667005247","671782000","249483000","271044336","271072715","271069008","273323000","671290000","620061000","247758000","271056019","271062118","577271000","245513000","247056200","271062116","248527000","357468000","229015000","566573000","304182000","271042940","271043599","271072886","271010409","636012771","214182609","538071006","636090971","271062075","373086000","248854000","215500000","341860000","235099513","218819000","248855000","271073069","247399000","510240000","357601000","235085467","271072878","477314900","271062119","271072211","212600000","271062032","271072146","636013823","538005406","572265000","219848000","271062033","271010373","271073011","271072120","248887000","353725000","256901000","304993000","636016919","371704000","636091484","271072761","271072070","312269000","271072187","229939000","271000893","304010857","271072889","450535000","249104000","538006040","271001045","271042610","271062000","311029800","271010074","477271600","235118542","620040000","271073060","273348300","219116000","671691000","229920000","374421000","311000534","636092405","271062040","636011023","271062022","256387000","667001237","271042527","518100200","271042799","241155000","273359180","511302000","271072163","511282000","538004843","341140000","636015457","215477000","305678000","271062023","271044546","271062024","271062039","319667000","249353000","351473000","273351430","271043908","271002718","538006998","372112000","271072217","312026000","538006032","271002352","636016323","271001000","271062018","304255000","241310000","271056003","240865000","677042400","538003343","240653000","214181711","511103000","273351960","477299000","477768300","564166000","246458000","357512000","372295000","636013067","229499000","273357260","271062110","271042197","636011289","565138000","319008400","249637000","538003691","247299300","538004361","563491000","538006174","357565000","312255000","305164000","671770000","248888000","305760000","356972000","271000683","676177000","207826720","636011072","624022000","271030098","353071000","636015446","271111111","271042599","667001567","271044143","256518000","566215000","351262000","271072290","271043399","371734000","249569000","247186500","271002013","271073164","538002806","676259000","271072219","357505000","357321000","273332530","671629000","271000325","538006886","374499000","311000275","273333100","229002000","676151000","538005192","241449000","518592000","538007033","538004166","356389000","271072056","247216300","271072065","271072712","235069272","566350000","538006230","538090457","271010394","271072558","636014991","563102000","271073135","319150000","255805846","304010290","511087000","271072450","352099000","271073190","671537000","312288000","236646000","249470000","271072291","538006703","423096100","636092013","373353000","271072622","466558090","244599000","271072687","271043553","273314800","667001312","229011000","229038000","308038000","271073136","271073186","271002699","245947000","215058000","271073008","271072141","214182009","677027700","271072694","215539000","667005192","271072365","271072264","271072348","271072349","255805886","992711189","271041991","257220000","353218000","636092600","271044569","370078000","229594000","271044109","271040197","354299000","215912000","538005363","354289000","271041516","352017000","271040565","312304000","620080000","245523000","247080200","219185000","239277000","271044578","352041000","219127000","538006523","271002383","271001092","572625210","271043946","564056000","518100201","271072040","271001029","249623000","271072660","256625000","271073138","636091770","311017500","538004159","271002292","376628000","271042493","248964000","271000260","538090401","271000319","209760000","538005074","538005650","215037000","314420000","229019000","636012425","271002160","538090480","271041868","256304000","240970000","271044090","273387430","271072123","305069000","241164000","667001408","271000985","357332000","375163000","312572000","354602000","374331000","477802800","636016319","374406000","229934000","577247000","538003431","235093065","271000450","353732000","518100028","357351000","273329500","992711077","636015848","215234000","312350000","620151000","271069032","273328500","271040594","273334900","207021000","271044302","236607000","255805812","636092745","538003930","636092653","273344600","271072428","271056072","271069017","477614800","236029000","271010627","271010738","271062138","577249000","271072686","273339700","235102498","642122020","244921000","271072210","229172000","636016275","244865000","538007055","249634000","413125000","212100000","538003243","271044385","372530000","538003910","671730000","370135000","312942000","356714000","256689000","357740000","255805802","271043190","271002370","273342890","214182105","355597000","271072258","538005372","256255000","271040755","271000609","214180608","667001332","275471000","314039000","511370000","372617000","235109905","271000862","249361000","357600000","636016736","229460000","240561000","248681000","271000978","450552000","565596000","256924000","636016857","457300000","671582000","256439000","271062063","271062133","256662000","271072747","239591000","372612000","273359260","538005065","214181915","538002316","423012100","271000677","351134000","271043058","214181714","272325000","538004530","477617900","311035600","477866900","636015815","256510000","249263000","620000003","636017609","247273400","273447370","371560000","987987987","271002135","419000116","676281000","271000747","229774000","244999000","247087700","244770393","271072379","636015671","518100116","477699400","271042692","572836210","240145000","229020000","564637000","538005983","235015979","271072304","636014506","564912000","311064300","229266000","518100241","357509000","271043028","229406000","215826000","271040130","538003620","374033000","538002543","538005692","304320000","271002499","235096356","565137000","355550000","577285000","246854000","636013143","636015914","636016475","987654300","538006420","312628000","273311240","636013839","305315000","229459000","271010451","538006225","249401000","548775000","667001281","370341000","538005747","636091351","240968000","636017597","374681000","316001697","636015750","247312400","636016420","636015347","246797000","240569000","518791000","305633000","229569000","518862000","256994000","354470000","271072360","271073067","272616382","444555666","355077000","538005042","370167000","305280000","636092124","565929000","271030088","311030200","271043738","256686000","642122012","538005261","271000637","236111817","255805892","538003786","563112000","271000651","215627000","229344000","271010830","477730900","374460000","563168517","215562000","538004603","214182417","271042477","477847700","271072069","215263000","422040800","304090000","477225800","271044588","374636000","304140000","219982000","992711029","229339000","351488000","271069013","214180810","312264000","220288000","518100164","257847600","271072104","271020072","271044205","636017476","457303000","271072560","249547000","538002382","372220000","538003308","271072254","241293000","248675000","249437000","271072608","272059000","273338780","667001450","676171000","271000642","676178000","676142000","256908000","304293000","305669000","636016926","667243000","249172000","636016360","341278000","271000898","636091701","271002459","577268000","620139000","477985300","676351000","255805561","312312000","375568000","477875000","518893000","271030085","273384210","256154000","372926000","235116324","273341040","372940000","215848000","538004629","249122000","538003432","677056100","271072180","271072097","538005408","620154000","671735000","620150000","271062069","215555000","636092684","210119000","271010683","271072009","354357000","620144000","214180914","271000965","664073000","249559000","249903000","273310010","271072569","271072087","271044528","354368000","312152000","214182612","271043838","273322210","271072002","212075000","305647000","273329400","273314230","229388000","353381000","240493000","468395000","341032000","273336920","341862000","271072577","371415000","214181716","271072286","538002315","636014802"};

	/**
	 * @return All distinct MMSI's from db.
	 * */
	public static ArrayList<Document> getAllDistinctMMSIs(){
		Document d = db.runCommand(new Document("$eval", "getAllDistinctMMSIs()"));
		d = (Document) d.get("retval");
		return (ArrayList<Document>) d.get("_batch");
	}

	/**
	 * Get information about vessel's movements in certain amount of time.
	 * Successor for mongodb getVesselInfo function.
	 *
	 * @param mmsi ID for the vessel
	 * @param startDate Starting limit for date in ISODate format
	 * @param endDate Ending limit for date in ISODate format
	 * @return Aggregated mongodb result for getVesselInfo function as ArrayList
	 *
	 * Usage: <getVesselInfo("616715000","2015-10-10 00:00:00.0","2017-10-10 00:00:00.0")>
	 * */
	public static ArrayList<Document> getVesselInfo(String mmsi, String startDate, String endDate){
		Document d = db.runCommand(new Document("$eval", "getVesselInfo(\""+mmsi+"\",\""+startDate+"\",\""+endDate+"\")"));
		d = (Document) d.get("retval");
		return (ArrayList<Document>) d.get("_batch");
	}

	/**
	 * Read csv based file and save each row as an entry to mongodb database.
	 *
	 * @param filePath Input file path
	 * */
	public static void addAISInCSVFormatToDB(String filePath){
		Scanner lineReader = null;
		int i=0;
		try {
			lineReader = new Scanner(new File(filePath));
			while (lineReader.hasNext())
			{
				String [] params = lineReader.nextLine().split(";");

				collection.insertOne(new Document().append("mmsi",params[2]).append("date",params[1]).append("lat",params[3]).append("lon",params[4]));
				if(i++%1000==0){
					System.out.println(i);
				}
			}
			lineReader.close();
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		}
	}
}
